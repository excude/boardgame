<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <title>보드게임 참석 페이지 (Google Sheets API)</title>
        <style>
            body { font-family: sans-serif; padding: 20px; max-width: 600px; margin: auto; }
                .box { border: 1px solid #ddd; padding: 15px; border-radius: 10px; margin-top: 20px; }
                    button { padding: 10px 15px; border: none; background: #3b82f6; color: white; border-radius: 8px; cursor: pointer; }
                        button:disabled { background: #999; cursor: default; }
                            input { padding: 8px; width: 100%; margin-top: 5px; }
                                h2 { margin-top: 30px; }
                                  </style>
                                  </head>
                                  <body>
                                    <h1>보드게임 참석 페이지</h1>

                                      <div class="box">
                                          <h2>게임 설정</h2>
                                              <label>게임 이름</label>
                                                  <input id="gameName" placeholder="예: 카탄" />

                                                      <label>최대 인원</label>
                                                          <input id="maxPlayers" type="number" placeholder="예: 4" />

                                                              <button onclick="saveGameSettings()">게임 설정 저장</button>
                                                                </div>

                                                                  <div class="box">
                                                                      <h2>참석하기</h2>
                                                                          <label>아이디(닉네임)</label>
                                                                              <input id="userId" placeholder="처음만 입력" />

                                                                                  <button onclick="attend()">참석</button>
                                                                                    </div>

                                                                                      <div class="box">
                                                                                          <h2>참석자 목록</h2>
                                                                                              <ol id="attendeeList"></ol>
                                                                                                </div>

                                                                                                <script>
                                                                                                // === Google Apps Script Web App URL ===
                                                                                                const API_URL = "https://script.google.com/macros/s/AKfycbyRyDB2meFk-mR4Pv_lOxjlAdfl7v9sizfO9vssD4zgwN-UM8qvf45LeO0RWhAqtMiqmw/exec"; // Apps Script로 만든 Web App URL 입력

                                                                                                let gameName = "";
                                                                                                let maxPlayers = 0;
                                                                                                let attendees = [];

                                                                                                async function saveGameSettings() {
                                                                                                  gameName = document.getElementById("gameName").value;
                                                                                                    maxPlayers = parseInt(document.getElementById("maxPlayers").value);

                                                                                                      const res = await fetch(API_URL + "?mode=save_settings", {
                                                                                                          method: "POST",
                                                                                                              body: JSON.stringify({ gameName, maxPlayers })
                                                                                                                });

                                                                                                                  alert("저장 완료!");
                                                                                                                    loadData();
                                                                                                                    }

                                                                                                                    async function attend() {
                                                                                                                      const idInput = document.getElementById("userId");
                                                                                                                        let userId = idInput.value.trim();

                                                                                                                          if (!userId) {
                                                                                                                              alert("아이디를 입력하세요.");
                                                                                                                                  return;
                                                                                                                                    }

                                                                                                                                      const res = await fetch(API_URL + "?mode=attend", {
                                                                                                                                          method: "POST",
                                                                                                                                              body: JSON.stringify({ userId })
                                                                                                                                                });

                                                                                                                                                  const data = await res.json();
                                                                                                                                                    if (!data.success) {
                                                                                                                                                        alert(data.message);
                                                                                                                                                          }

                                                                                                                                                            loadData();
                                                                                                                                                            }

                                                                                                                                                            async function loadData() {
                                                                                                                                                              const res = await fetch(API_URL + "?mode=load");
                                                                                                                                                                const data = await res.json();

                                                                                                                                                                  gameName = data.gameName;
                                                                                                                                                                    maxPlayers = data.maxPlayers;
                                                                                                                                                                      attendees = data.attendees;

                                                                                                                                                                        document.getElementById("gameName").value = gameName;
                                                                                                                                                                          document.getElementById("maxPlayers").value = maxPlayers;

                                                                                                                                                                            document.getElementById("attendeeList").innerHTML = attendees
                                                                                                                                                                                .map(x => `<li>${x}</li>`) 
                                                                                                                                                                                    .join("");
                                                                                                                                                                                    }

                                                                                                                                                                                    loadData();
                                                                                                                                                                                    </script>
                                                                                                                                                                                    </body>
                                                                                                                                                                                    </html>
                                                                                                                                                                                    